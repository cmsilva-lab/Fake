// ==UserScript==
// @name Fakes Bito V5
// @include **pt*
// @grant none
// ==/UserScript==


var x = 0;

//***************************************************************//
//                          User Input                           //
//***************************************************************//

// Colocar aqui tempo entre ataques (em milisegundos)
var tempo = 500;

// Meter 1 pra enviar fakes, 0 para enviar todas as tropas
var fake = 0;

// Meter aqui numero maximo de fakes a chegar a cada aldeia inimiga
var FakesPorAldeia = 1;

// Meter aqui numero de unidades a enviar em cada ataque quando opção fake está ativa (a 1)
var sp = 0;
var sw = 0;
var ax = 0;
var scout = 1;
var lc = 0;
var hv = 0;
var cat = 13;
var ra = 0;

// Meter aqui o numero maximo de fakes a sair da aldeia atual
var maxFakesAldeia = 1;

// Meter aqui as coordenadas onde enviar fakes
var coords = " 495|548 500|581 475|684 491|689 487|681 470|685 491|684 499|685 460|677 478|688 492|681 458|678 485|686 480|686 460|680 496|685 461|678 494|689 477|682 490|689 464|685 467|680 472|684 454|676 462|684 483|688 460|684 492|687 476|680 479|663 489|654 489|655 490|655 488|666 488|667 487|665 488|668 490|658 490|657 489|657 488|658 477|667 492|654 492|652 489|659 491|661 491|659 493|662 476|660 492|660 476|661 491|652 475|671 476|665 497|655 493|656 496|658 495|658 494|660 495|659 496|660 475|667 484|673 471|672 493|673 493|674 482|673 467|670 474|670 476|672 479|672 497|654 495|654 497|653 496|653 497|657 497|658 494|652 493|653 494|661 495|655 498|658 490|659 496|668 496|669 497|670 494|672 495|671 494|670 488|674 495|667 488|673 478|672 492|671 468|669 468|671 485|676 482|674 478|668 471|675 402|623 388|617 424|619 378|599 377|599 376|600 374|599 372|601 357|608 359|612 363|616 366|613 396|648 397|645 413|668 407|654 397|647 348|592 346|598 411|661 397|649 420|662 406|651 401|653 398|655 397|655 412|663 402|658 402|657 392|652 412|660 396|652 397|652 400|653 406|659 393|655 408|665 413|667 399|650 389|655 375|596 375|593 377|600 374|590 376|599 374|602 376|602 376|594 376|601 375|599 401|624 373|608 373|599 360|601 372|607 415|659 360|602 361|601 357|599 398|634 397|635 364|610 395|639 393|638 397|641 345|576 342|570 367|616 358|607 364|612 355|604 358|611 356|607 350|600 357|611 402|651 408|651 362|610 395|645 358|614 392|644 397|651 397|642 399|646 347|597 403|652 392|645 395|644 367|628 405|656 401|655 390|640 404|659 408|655 394|654 401|659 407|660 395|655 399|651 401|652 415|618 413|620 415|621 403|609 406|612 413|626 413|625 339|580 352|597 427|668 401|646 423|666 400|651 356|603 409|660 405|655 411|662 425|663 344|598 355|607 424|666 354|607 358|608 347|596 350|598 421|667 401|656 417|664 434|670 353|610 431|673 422|668 430|668 417|661 354|585 418|614 403|612 407|607 406|610 402|608 408|607 408|610 408|608 413|613 409|609 402|611 404|612 403|613 401|613 403|611 407|621 403|617 408|619 407|620 404|611 406|617 415|624 412|628 409|625 353|585 344|591 415|657 414|660 406|657 404|650 422|667 354|599 423|668 428|662 359|607 349|594 358|606 352|609 417|663 348|599 412|665 421|670 417|662 427|670 426|673 431|669 419|668 352|607 400|659 410|630 407|610 444|639 447|640 448|664 457|672 451|669 410|655 446|668 409|650 402|644 404|647 404|645 454|674 409|649 441|667 379|530 377|529 379|531 375|528 376|527 377|537 373|515 373|533 372|529 373|525 375|529 376|526 379|540 371|526 373|514 371|541 371|546 370|540 370|544 370|529 370|527 369|545 370|535 371|542 372|541 369|539 366|542 368|542 369|541 345|570 348|591 344|580 347|593 347|590 340|581 342|596 342|595 329|565 340|567 341|563 342|568 339|570 329|539 342|587 347|595 349|588 343|587 327|562 341|592 341|585 328|565 341|587 326|560 344|590 340|590 337|580 343|589 341|590 340|586 327|560 373|513 442|652 442|651 440|653 436|651 415|585 400|583 396|584 402|629 440|661 448|662 439|664 441|650 415|584 414|583 415|583 404|576 404|580 403|583 404|583 404|581 397|576 410|595 397|584 398|584 400|591 399|595 403|592 400|626 375|605 376|607 377|606 399|626 453|660 436|655 375|607 449|660 375|612 436|650 372|608 454|663 450|662 401|631 454|665 447|663 456|665 450|665 453|664 448|661 373|609 402|643 422|636 440|645 456|623 452|631 450|633 433|637 436|637 427|638 448|668 428|664 441|623 447|630 450|632 446|631 449|634 442|635 447|633 440|630 445|640 451|641 449|642 435|638 428|639 431|640 428|640 428|642 429|643 389|644 439|674 434|671 443|671 442|619 442|624 438|625 447|628 448|630 415|635 376|622 466|613 477|598 474|625 476|629 445|637 466|614 472|600 464|599 474|604 472|604 479|606 472|606 484|612 475|610 478|614 494|615 479|612 482|613 475|612 488|614 488|618 486|621 473|614 479|623 482|625 483|626 481|627 449|619 460|630 480|628 479|635 470|634 446|624 444|625 479|636 480|634 488|632 467|632 477|633 463|630 479|634 435|630 465|666 492|677 442|675 470|606 463|615 467|609 472|617 469|604 467|629 471|608 472|614 477|626 467|614 473|622 472|612 474|623 466|612 474|616 466|615 470|612 465|612 461|617 469|617 468|617 466|616 464|617 466|617 467|612 472|609 464|613 477|615 465|622 468|600 421|574 419|577 418|575 415|577 420|579 424|575 416|575 419|573 419|578 417|572 422|570 414|574 418|577 418|576 413|570 414|571 415|565 417|573 418|574 409|569 399|600 398|604 398|606 416|570 416|577 417|576 414|572 398|610 400|606 415|567 419|574 410|570 428|572 396|609 422|571 419|571 401|600 400|602 399|610 374|611 374|608 356|599 350|597 375|609 375|611 375|610 460|540 459|538 456|538 373|586 377|596 372|587 370|593 371|595 369|590 373|593 367|587 362|581 369|593 372|597 369|591 367|590 371|593 373|604 370|604 369|601 370|594 368|600 365|603 372|603 374|607 366|603 364|602 372|604 371|606 475|601 484|603 486|606 484|609 478|605 493|679 419|661 415|656 494|675 400|645 361|559 362|561 360|562 352|552 489|604 362|562 354|552 411|631 488|678 478|602 338|580 491|681 457|675 491|677 399|647 483|680 489|598 481|608 499|683 453|673 489|682 490|677 495|682 395|562 361|561 359|560 358|559 510|524 508|519 509|526 486|553 509|512 507|519 458|545 459|544 459|516 459|524 461|519 459|522 457|543 457|545 459|521 454|506 485|552 459|545 459|543 485|554 455|505 455|506 453|505 453|504 458|543 454|504 456|507 458|546 457|506 459|546 333|566 334|564 333|565 332|566 331|570 350|599 329|568 334|570 341|595 334|571 330|570 327|568 333|570 330|568 347|609 356|602 354|612 353|605 353|607 349|603 397|648 353|606 348|602 354|614 357|603 345|600 350|603 399|652 354|609 351|605 347|600 357|618 354|616 344|602 352|603 347|610 343|600 347|604 342|604 347|612 348|603 350|606 348|600 345|601 352|605 324|569 339|603 346|610 379|549 373|548 366|550 371|552 365|549 363|550 358|550 357|558 372|566 370|566 360|549 477|640 477|639 480|640 481|633 478|634 479|633 471|630 468|648 459|644 471|638 462|639 482|538 467|641 462|642 470|637 470|638 473|640 474|638 463|643 464|641 468|642 467|639 469|643 470|647 470|642 466|640 471|639 471|637 475|638 476|638 481|646 481|531 474|526 483|536 482|531 494|538 480|526 476|525 476|533 476|534 467|534 485|529 471|545 489|537 486|539 483|541 493|533 485|535 489|536 484|542 455|644 452|646 451|647 450|642 491|660 475|666 466|671 464|668 474|641 482|642 482|643 479|644 477|643 471|644 473|644 471|646 471|645 480|643 472|645 478|644 470|646 476|673 461|637 480|644 483|643 484|641 471|643 481|642 468|653 391|560 408|616 405|625 406|624 376|614 375|615 432|633 430|634 428|638 427|640 434|630 432|640 434|641 430|640 427|641 428|641 437|642 447|632 465|674 461|674 455|674 442|670 395|618 376|611 368|574 366|573 369|569 367|575 371|575 366|574 364|586 372|569 371|567 373|566 370|569 368|569 370|568 354|591 357|591 358|599 369|599 353|587 390|592 364|604 351|592 352|590 355|600 350|589 347|587 344|577 431|670 437|672 351|600 354|608 363|623 341|599 356|612 344|552 365|592 358|556 375|621 502|462 329|572 356|555 353|559 353|555 448|670 344|560 470|661 466|666 342|566 353|554 350|615 468|661 363|593 361|553 361|555 390|559 468|662 333|569 401|548 329|570 363|554 360|551 361|550 362|555 388|558 389|549 360|555 361|554 365|520 399|603 395|603 394|608 392|608 393|608 386|605 395|609 383|606 382|610 384|612 379|606 381|610 380|610 391|622 380|614 381|611 380|611 371|605 379|611 377|614 404|626 408|649 404|625 403|625 409|623 402|628 401|623 402|621 393|621 385|630 395|643 373|624 400|624 405|626 428|669 427|674 426|677 433|673 430|676 420|670 398|658 395|659 447|679 407|535 484|649 484|648 485|648 488|648 485|646 487|645 480|649 485|643 490|646 482|652 481|645 484|645 485|647 482|650 483|647 487|646 485|651 485|645 486|647 486|646 488|645 482|653 479|649 489|648 483|645 489|649 483|652 483|653 481|653 489|647 479|650 485|642 482|645 481|652 481|650 480|648 490|648 486|649 364|570 362|569 364|569 363|570 364|568 360|571 359|577 361|575 360|573 364|572 362|573 364|573 364|574 365|545 353|581 385|573 384|573 389|572 388|568 383|575 388|572 388|567 391|570 427|541 427|539 378|593 377|588 373|578 424|540 423|540 423|541 387|570 459|639 459|640 459|638 458|638 456|639 454|643 457|638 461|640 459|641 459|643 459|642 460|641 458|642 457|641 460|642 460|643 457|642 466|624 482|654 489|652 412|633 376|623 377|628 355|603 373|628 369|618 374|624 371|626 373|630 375|636 375|630 368|624 378|623 365|627 369|548 357|562 355|561 357|560 377|525 358|562 356|559 355|558 358|563 357|563 386|627 385|629 394|646 385|626 402|652 475|623 475|625 476|625 485|613 479|628 463|621 466|623 470|628 492|609 493|617 483|640 436|555 391|566 389|564 389|567 389|566 393|574 381|570 377|565 376|565 376|566 357|552 345|508 342|533 340|513 491|651 488|653 490|652 446|641 490|656 488|656 489|658 486|659 491|665 445|673 377|559 369|557 367|557 368|558 369|552 366|554 369|551 368|552 367|553 365|555 409|659 435|626 411|603 378|602 377|603 403|651 356|606 371|568 366|570 367|569 363|599 363|606 353|609 349|605 482|600 472|631 467|624 461|614 463|616 480|632 455|671 366|547 365|546 366|549 366|545 362|547 365|552 467|502 462|499 461|494 456|544 454|556 460|682 450|609 449|607 448|610 450|610 451|610 451|609 449|610 407|657 406|656 403|654 398|652 408|667 408|662 399|655 404|658 451|533 421|521 420|523 397|525 409|639 386|589 386|587 387|588 382|594 383|595 382|598 385|594 388|597 405|607 405|608 406|608 403|606 406|609 367|565 366|567 365|565 364|564 361|537 477|618 484|620 376|559 406|611 406|613 413|575 406|614 405|613 498|648 501|645 498|647 497|647 451|554 493|655 495|657 492|656 496|659 495|656 497|660 480|646 478|640 481|644 479|640 478|645 479|643 437|551 436|551 451|607 450|608 448|606 448|607 451|606 451|608 490|532 483|641 483|644 484|535 504|525 503|526 678|462 475|646 470|645 461|642 485|546 374|589 367|538 395|347 677|443 484|650 439|637 386|594 613|356 669|421 543|519 538|600 431|667 474|645 476|545 642|611 676|551 476|645 673|441 368|367 604|344 389|571 "

//***************************************************************//
//***************************************************************//

var doc = document;
var url = document.URL;
var cookieName = "farmeruk";
var cookieNameTent = "tentcookie";
var maxTentativas = 1;
var data;
var h2 = document.getElementsByTagName('h2');
var Praca = false;
var EnviarAtaque = false;

for (i = 0; i < h2.length; i++)
{
    if (h2[i].innerHTML == "Praça de Reuniões (nível 1)")
    {
        Praca = true;
    }
    else if(h2[i].innerHTML.search("Confirmar ataque a") != -1)
    {
        EnviarAtaque=true;
    }
}

if (Praca == EnviarAtaque)
    var tentCookie = document.cookie.match('(^|;) ?' + cookieNameTent + '=([^;]*)(;|$)');

if (tentCookie != null)
{
    var numTentativas = parseInt(tentCookie[2]);
}
else
{
    data = new Date(2050, 11, 11);
    document.cookie = cookieNameTent + "=0;expires=" + data.toGMTString();
    var numTentativas = 0;
}

if (Praca)
{
    if (document.getElementsByClassName("error_box")[0] != undefined)
    {
        var erroFaltaUnid = document.getElementsByClassName("error_box");
        for (i = 0; i < erroFaltaUnid.length && !found; i++)
        {
            if (erroFaltaUnid[i].innerHTML.search("Não existem unidades suficientes") != -1)
            {
                altAldeia();
                throw '';
            }/*else if (erroFaltaUnid[i].innerHTML.search("Até 16.5. 18:41, apenas pode atacar e ser atacado se a diferença entre os seus pontos e os do inimigo for no máximo 20 : 1.") != -1){
                 index = index + 1;
                 cookie_date = new Date(2020, 11, 11);
                 document.cookie = cookieName + "=" + index + ";expires=" + cookie_date.toGMTString();
                 window.location.reload();
            }else if (document.getElementsByClassName("error_box")[0].innerText.equals("Este jogador foi bloqueado e, por isso, não pode ser atacado nem apoiado.")){
                 index = index + 1;
                 cookie_date = new Date(2020, 11, 11);
                 document.cookie = cookieName + "=" + index + ";expires=" + cookie_date.toGMTString();
                 window.location.reload();
            }
            else{
                altAldeia();
                throw '';}*/


        }

    }

    if (doc.forms[0].x.value != "")
    {
        var index = 0;
        var fakesAldeia = 0;
        farmcookie = document.cookie.match('(^|;) ?' + cookieName + '=([^;]*)(;|$)');

        if (farmcookie != null)
        {
            index = parseInt(farmcookie[2].split("-")[0]);
            fakesAldeia = parseInt(farmcookie[2].split("-")[1]);
        }


        if( fakesAldeia>=maxFakesAldeia){
            fakesAldeia = 0;
            cookie_date = new Date(2050, 11, 11);
            document.cookie = cookieName + "=" + index + "-" + fakesAldeia + ";expires=" + cookie_date.toGMTString();
            altAldeia();

        }
        setTimeout(function() {
            if (index >= coords.length)
            {
                index = 0;
            }

            index = index + 1;
            fakesAldeia = fakesAldeia + 1;
            cookie_date = new Date(2050, 11, 11);
            document.cookie = cookieName + "=" + index + "-" + fakesAldeia + ";expires=" + cookie_date.toGMTString();
            var link = document.getElementsByClassName("quickbar_link");

            for (i = 0; i < link.length; i++)
            {
                if (link[i].href.search(/screen=place/) != -1)
                {
                    window.location.href = link[i].href;
                }
            }
         }, 1000);
    }

    else
    {
        if (window.frames.length > 0)
        {
            doc = window.main.document;
        }

        url = document.URL;
        coords = coords.split(" ");
        var index = 0;
        var fakesAldeia = 0;
        farmcookie = document.cookie.match('(^|;) ?' + cookieName + '=([^;]*)(;|$)');
        if (farmcookie != null)
        {
            index = parseInt(farmcookie[2].split("-")[0]);
            fakesAldeia = parseInt(farmcookie[2].split("-")[1]);
        }
        console.log(fakesAldeia);
        if( fakesAldeia >= maxFakesAldeia){
            cookie_date = new Date(2050, 11, 11);
            fakesAldeia = 0;
            document.cookie = cookieName + "=" + index + "-" + 0 + ";expires=" + cookie_date.toGMTString();
            altAldeia();

        }
        setTimeout(function() {
            if (index >= coords.length)
            {
                index = 0;
            }

            if (document.getElementsByClassName("command-list-count") [0] != undefined)
            {
                var numAtaques = document.getElementsByClassName("command-list-count") [0].innerHTML;
            }
            else
            {
                var numAtaques = 0;
            }

            if (numAtaques < FakesPorAldeia)
            {
                if (numTentativas <= maxTentativas)
                {
                    coords = coords[index];
                    coords = coords.split("|");
                    index = index + 1;
                    fakesAldeia = fakesAldeia + 1;
                    cookie_date = new Date(2050, 11, 11);
                    document.cookie = cookieName + "=" + index + "-" + fakesAldeia + ";expires=" + cookie_date.toGMTString();
                    doc.forms[0].x.value = coords[0];
                    doc.forms[0].y.value = coords[1];
                    if (scout==-1){
                        document.getElementById('units_entry_all_spy').click();
                    }
                    else{
                        doc.forms[0].spy.value = scout;
                    }
                    if (sp==-1){
                        document.getElementById('units_entry_all_spear').click();
                    }
                    else{
                        doc.forms[0].spear.value = sp;
                    }
                    if (sw==-1){
                        document.getElementById('units_entry_all_sword').click();
                    }
                    else{
                        doc.forms[0].sword.value = sw;
                    }
                    if (ax==-1){
                        document.getElementById('units_entry_all_axe').click();
                    }
                    else{
                        doc.forms[0].axe.value = ax;
                    }
                    if (lc==-1){
                        document.getElementById('units_entry_all_light').click();
                    }
                    else{
                        doc.forms[0].light.value = lc;
                    }
                    if (hv==-1){
                        document.getElementById('units_entry_all_heavy').click();
                    }
                    else{
                        doc.forms[0].heavy.value = hv;
                    }
                    if (ra==-1){
                        document.getElementById('units_entry_all_ram').click();
                    }
                    else{
                        doc.forms[0].ram.value = ra;
                    }
                    if (cat==-1){
                        document.getElementById('units_entry_all_catapult').click();
                    }
                    else{
                        doc.forms[0].catapult.value = cat;
                    }

		    if (fake == 0) {
                    document.getElementById("selectAllUnits").click();
                    }


                    document.forms[0].attack.click();
                }
                else
                {
                    data = new Date(2050, 11, 11);
                    document.cookie = cookieName + "=" + index + ";expires=" + cookie_date.toGMTString();
                    altAldeia();
                }

            }
            else
        {
           altAldeia();
        }
        }, 2000);


    }
}

else if (EnviarAtaque)
{
    var BNCheck = document.getElementsByClassName("error");
    var found = false;

    for (i = 0; i < BNCheck.length && !found; i++)
    {
        if (BNCheck[i].innerHTML == "Bónus noturno ativo!")
        {
            found = true;
            console.log("BN")
        }
    }
    if (found)
    {
        var link = document.getElementsByClassName("quickbar_link");

        for (i = 0; i < link.length; i++)
        {
            if (link[i].href.search(/screen=place/) != -1)
            {
                numTentativas = numTentativas + 1; data = new Date(2050, 11, 11);
                document.cookie = cookieNameTent + "=" + numTentativas + ";expires=" + data.toGMTString();
                window.location.href = link[i].href;
            }
        }

    }
    /*else if($(".relative_time").text().includes("amanhã") == false ){
        document.getElementById("village_switch_right").click();

    }*/
    else
    {
        setTimeout(function() {
            document.forms[0].troop_confirm_submit.click();
            }, tempo);
    }


}
function altAldeia() {
    $('.arrowRight').click();
       $('.groupRight').click();
       $('div.arrow.arrowRight').click();
       $('div.arrow.groupRight').click();

if($('.groupRight').length<1 && $('.arrowRight').length<1)
    window.location.reload();
}
